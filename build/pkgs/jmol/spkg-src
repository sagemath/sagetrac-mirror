#!/usr/bin/env bash -x

set -e

cd "$(dirname ${0})"

# fetch and unpack upstream source
rm -f download
wget https://sourceforge.net/projects/jmol/files/latest/download
rm -rf jmol-*
unzip download

# guess package version
JMOL_VERSION="$(echo jmol-* | sed 's/.*-//g')"
echo ${JMOL_VERSION}
JMOL_VERSION_SHORT=${JMOL_VERSION:0:5}

rm -f jmol-${JMOL_VERSION}/jsmol.zip

# install tarball, fix version and checksums in sage source
tar cvjf ../../../upstream/jmol-${JMOL_VERSION}.tar.bz2 jmol-${JMOL_VERSION}
echo "${JMOL_VERSION}" > package-version.txt
../../../sage --package fix-checksum jmol

# cleanup
rm -rf jmol-${JMOL_VERSION}
rm download

