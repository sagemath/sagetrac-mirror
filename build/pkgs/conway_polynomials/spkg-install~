#!/usr/bin/env python

# FIXME: replace by juliens install script that doesnt depend on SAGERUNTIME

import os
import sys
s = os.getcwd()
sys.path.append(s)
from src import conway_polynomials
from sage.all import save
from sage.env import SAGE_SHARE, SAGE_LOCAL

# for some reason, this is necessary.
# shouldn't breake anything in case it's not
os.chdir(os.getcwd())

install_root = os.path.join(SAGE_SHARE, 'conway_polynomials')

def create_db():
    db = {}
    from src import conway_polynomials
    for p,n,v in conway_polynomials:
        if not db.has_key(p):
            db[p] = {}
        db[p][n] = v
    if not os.path.exists(install_root):
        os.makedirs(install_root)
    save(db, os.path.join(install_root, 'conway_polynomials.sobj'))

# fixme: use "install", or write filelist somehow.
def create_env():
    SAGE_ETC = SAGE_LOCAL + "/etc/env.d"
    if not os.path.exists(SAGE_ETC):
        os.makedirs(SAGE_ETC)
    f = open(os.path.join(SAGE_ETC,"conway.sh"), "w+")
    f.write('CONWAY_DATA_DIR="$SAGE_SHARE/conway_polynomials"\n')
    f.write('export CONWAY_DATA_DIR\n')
    f.close

if __name__ == '__main__':
    create_db()
    create_env()
