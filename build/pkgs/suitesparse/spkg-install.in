# -*- shell-script -*-
cd src

# Trac #30478: suitesparse 5.10.1 uses -std=c99 even with g++
# by the following setting in SuiteSparse_config/SuiteSparse_config.mk
# CF ?= -std=c99 $(CFLAGS) $(CPPFLAGS) $(TARGET_ARCH) $(OPTIMIZATION) -fexceptions -fPIC
# Override this:
export CF="${CFLAGS} ${CPPFLAGS} -fexceptions -fPIC"

echo "print configuration"
$MAKE MY_METIS_LIB=none CHOLMOD_CONFIG=-DNPARTITION \
      BLAS="$(pkg-config --libs blas)" LAPACK="$(pkg-config --libs lapack)" \
      INSTALL="$SAGE_LOCAL" DESTDIR="$SAGE_DESTDIR" config
# build and install
$MAKE MY_METIS_LIB=none CHOLMOD_CONFIG=-DNPARTITION \
      BLAS="$(pkg-config --libs blas)" LAPACK="$(pkg-config --libs lapack)" \
      INSTALL="$SAGE_LOCAL" DESTDIR="$SAGE_DESTDIR" install

