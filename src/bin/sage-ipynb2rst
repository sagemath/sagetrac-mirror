#!/usr/bin/env bash

fail () {
    echo "ERROR: ${1}" 1>&2
    exit 1
}

help () {
    cat << EOF
Usage:

    sage -ipynb2rst <source> [<destination>]

Generates reStructuredText source (.rst) from IPython worksheet (.ipynb).

If the destination is not specified, the reStructuredText source is written in
the standard output.

Examples:

    sage -ipynb2rst file.ipynb file.rst

    sage -ipynb2rst file.ipynb

Options:
  -h, --help            show this help message and exit
EOF
}

if [ "${1}" = '-h' ] || [ "${1}" = '--help' ] ; then help ; exit 0 ; fi

# tests if dependencies are available
pandoc -v > /dev/null 2>&1 || fail 'sage -ipynb2rst requires pandoc; please install it on your system.'

case  "${#}" in
    (1)
        jupyter nbconvert --to rst --RSTExporter.template_path=[\'$SAGE_EXTCODE/nbconvert/\'] --RSTExporter.template_file='rst_sage.tpl' --stdout ${1} | sed 's/:math://g' || ( echo -e '\n' ; help ) ;;
    (2)
        jupyter nbconvert --to rst --RSTExporter.template_path=[\'$SAGE_EXTCODE/nbconvert/\'] --RSTExporter.template_file='rst_sage.tpl' --stdout ${1} | sed 's/:math://g' > ${2} ( echo -e '\n' ; help ) ;;
    (*)
        help ;;
esac

exit 0

